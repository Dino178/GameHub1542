<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Ultimate Game Hub</title>
<style>
:root{
  --bg:#0b0c0e; --panel:#111214; --muted:#9aa0a6; --accent:#ffd166;
  --card:#141518; --ok:#2ecc71; --bad:#e74c3c;
}
*{box-sizing:border-box}
body{margin:0;font-family:Inter,system-ui,Segoe UI,Arial,sans-serif;background:var(--bg);color:#e7eef6}
header{background:var(--panel);padding:18px 24px;text-align:center}
header h1{margin:0;color:var(--accent)}
main{max-width:1100px;margin:18px auto;padding:18px}
.menu, .panel{background:var(--card);padding:16px;border-radius:10px;margin-bottom:14px}
button{background:#1f2226;color:#fff;border:0;padding:8px 12px;border-radius:8px;margin:6px;cursor:pointer}
select,input,textarea{padding:8px;border-radius:8px;border:1px solid #222;background:#0e0f11;color:#fff}
label{color:var(--muted);margin-right:10px}
.controls{margin:8px 0}
.small{font-size:13px;color:var(--muted)}
.leaderboard{background:#0e1012;padding:10px;border-radius:8px;margin-top:12px;max-height:260px;overflow:auto;text-align:left}
.resultline{margin-top:8px;color:var(--muted)}
.achievement{color:var(--accent);font-weight:700;margin-top:6px;display:block}
#reactionArea{width:340px;height:140px;margin:14px auto;border-radius:10px;display:flex;align-items:center;justify-content:center;user-select:none;cursor:pointer}
.color-btn{width:64px;height:64px;border-radius:8px;display:inline-block;margin:6px;border:3px solid rgba(255,255,255,0.06);cursor:pointer}
.hidden{display:none}
.inline{display:inline-block}
.game-title{margin:0 0 8px 0}
ol{margin:8px 0 0 18px;padding:0}
.panel-grid{display:grid;grid-template-columns:1fr;gap:12px}
.top-result{margin-top:8px;padding:10px;background:#0f1113;border-radius:8px}
small.muted{color:var(--muted)}
</style>
</head>
<body>
<header><h1>Ultimate Game Hub</h1></header>
<main>
<section class="menu" id="mainMenu">
  <h2 class="game-title">Games</h2>
  <div class="controls">
    <button onclick="enterGame('guess')">Guess the Number</button>
    <button onclick="enterGame('math')">Math Quiz</button>
    <button onclick="enterGame('reaction')">Reaction Game</button>
    <button onclick="enterGame('typing')">Gibberish Typing</button>
    <button onclick="enterGame('numMemory')">Number Memory</button>
    <button onclick="enterGame('seqTap')">Sequence Tap</button>
    <button onclick="enterGame('wordChain')">Word Memory Chain</button>
  </div>
  <div class="small">Leaderboards persist locally or online depending on settings.</div>
  <div class="controls">
    <label>Leaderboard Mode:
      <select id="leaderboardMode">
        <option value="online" selected>Online</option>
        <option value="offline">Offline</option>
      </select>
    </label>
  </div>
</section>

<!-- Panels for each game -->
<section class="panel hidden" id="panel-guess">
  <h2>Guess the Number</h2>
  <div id="guessNameArea"></div>
  <div>
    <input type="number" id="guessInput" placeholder="1-100"/>
    <button id="guessBtn">Guess</button>
  </div>
  <div id="guessMsg" class="resultline"></div>
  <div class="leaderboard" id="lb-guess"></div>
  <button onclick="returnToMenu()">Back to Menu</button>
</section>

<section class="panel hidden" id="panel-math">
  <h2>Math Quiz</h2>
  <div id="mathNameArea"></div>
  <div id="mathQuestion" class="resultline"></div>
  <input type="number" id="mathAnswer"/>
  <button id="mathBtn">Submit</button>
  <div id="mathMsg" class="resultline"></div>
  <div class="leaderboard" id="lb-math"></div>
  <button onclick="returnToMenu()">Back to Menu</button>
</section>

<section class="panel hidden" id="panel-reaction">
  <h2>Reaction Game</h2>
  <div id="reactionArea">Click when it turns green!</div>
  <div>Rounds: <input type="number" id="reactionRounds" value="5" min="1" max="20"/></div>
  <div class="leaderboard" id="lb-reaction"></div>
  <button onclick="returnToMenu()">Back to Menu</button>
</section>

<section class="panel hidden" id="panel-typing">
  <h2>Gibberish Typing</h2>
  <div id="typingNameArea"></div>
  <div id="typingText" class="resultline"></div>
  <input type="text" id="typingInput"/>
  <button id="typingBtn">Submit</button>
  <div id="typingMsg" class="resultline"></div>
  <div class="leaderboard" id="lb-typing"></div>
  <button onclick="returnToMenu()">Back to Menu</button>
</section>

<section class="panel hidden" id="panel-numMemory">
  <h2>Number Memory</h2>
  <div id="numMemoryNameArea"></div>
  <div id="numMemoryDisplay" class="resultline"></div>
  <input type="text" id="numMemoryInput"/>
  <button id="numMemoryBtn">Submit</button>
  <div id="numMemoryMsg" class="resultline"></div>
  <div class="leaderboard" id="lb-numMemory"></div>
  <button onclick="returnToMenu()">Back to Menu</button>
</section>

<section class="panel hidden" id="panel-seqTap">
  <h2>Sequence Tap</h2>
  <div id="seqTapNameArea"></div>
  <div id="seqTapDisplay" class="resultline"></div>
  <div id="seqTapButtons"></div>
  <div class="leaderboard" id="lb-seqTap"></div>
  <button onclick="returnToMenu()">Back to Menu</button>
</section>

<section class="panel hidden" id="panel-wordChain">
  <h2>Word Memory Chain</h2>
  <div id="wordChainNameArea"></div>
  <div id="wordChainDisplay" class="resultline"></div>
  <input type="text" id="wordChainInput"/>
  <button id="wordChainBtn">Submit</button>
  <div id="wordChainMsg" class="resultline"></div>
  <div class="leaderboard" id="lb-wordChain"></div>
  <button onclick="returnToMenu()">Back to Menu</button>
</section>

<script type="module">
// Firebase setup
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.3.1/firebase-app.js";
import { getDatabase, ref, push, get } from "https://www.gstatic.com/firebasejs/10.3.1/firebase-database.js";

const firebaseConfig = {
  apiKey: "AIzaSyBrY0AdHrWI0FdCdhJuTHb43E4HHsJ-2FQ",
  authDomain: "arcade-games-1e219.firebaseapp.com",
  databaseURL: "https://arcade-games-1e219-default-rtdb.firebaseio.com",
  projectId: "arcade-games-1e219",
  storageBucket: "arcade-games-1e219.appspot.com",
  messagingSenderId: "790089373336",
  appId: "1:790089373336:web:aea31e89728f14bc67e2ed"
};
const app = initializeApp(firebaseConfig);
const db = getDatabase(app);

// ----------------- Utilities -----------------
function now(){ return performance.now(); }
function msToSec(ms){ return ms/1000; }
function escapeHTML(s){ return String(s).replace(/[&<>"]/g, c=>({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;'}[c])); }

// ----------------- Leaderboards -----------------
async function saveToOnlineLB(game, mode, entry){
  const lbMode = document.getElementById('leaderboardMode').value;
  if(lbMode!=='online'){ saveToLocalLB(game,mode,entry); return; }
  await push(ref(db, `leaderboards/${game}/${mode}`), entry);
}
function saveToLocalLB(game,mode,entry){
  const key=`LH_${game}_${mode}`;
  let arr=JSON.parse(localStorage.getItem(key)||'[]');
  arr.push(entry); arr.sort((a,b)=> a.time-b.time); arr=arr.slice(0,100);
  localStorage.setItem(key, JSON.stringify(arr));
}
async function showLBIn(containerId,game,mode){
  const container=document.getElementById(containerId);
  const lbMode = document.getElementById('leaderboardMode').value;
  let arr=[];
  if(lbMode==='online'){
    const snapshot = await get(ref(db, `leaderboards/${game}/${mode}`));
    if(snapshot.exists()){ arr=Object.values(snapshot.val()); }
  } else {
    const key=`LH_${game}_${mode}`;
    arr=JSON.parse(localStorage.getItem(key)||'[]');
  }
  if(!arr.length){ container.innerHTML='<i>No scores yet.</i>'; return; }
  arr.sort((a,b)=> a.time-b.time).slice(0,100);
  let html='<ol>';
  arr.forEach(e=>{ html+=`<li>${escapeHTML(e.name)} — ${e.time.toFixed(3)}s</li>`; });
  html+='</ol>'; container.innerHTML=html;
}

// ----------------- Navigation -----------------
window.__playerName='Player';
function hideAllPanels(){ document.querySelectorAll('.panel').forEach(p=>p.classList.add('hidden')); }
function returnToMenu(){ hideAllPanels(); document.getElementById('mainMenu').style.display='block'; }
function enterGame(key){
  hideAllPanels();
  const panel=document.getElementById('panel-'+key);
  panel.classList.remove('hidden');
  if(key==='reaction'){ window.__playerName='Player'; initReaction(); return; }
  const nameArea=document.getElementById(key+'NameArea'); nameArea.innerHTML='';
  const inp=document.createElement('input'); inp.placeholder='Your name';
  const btn=document.createElement('button'); btn.textContent='Start';
  nameArea.appendChild(inp); nameArea.appendChild(btn);
  btn.onclick=()=>{ 
    window.__playerName=(inp.value||'Player').trim()||'Player';
    nameArea.innerHTML='<b>Player: </b>'+escapeHTML(window.__playerName);
    if(key==='guess') initGuess();
    if(key==='math') initMath();
    if(key==='typing') initTyping();
    if(key==='numMemory') initNumMemory();
    if(key==='seqTap') initSeqTap();
    if(key==='wordChain') initWordChain();
  };
  inp.addEventListener('keydown', e=>{ if(e.key==='Enter') btn.click(); });
}

// ----------------- Reaction Game -----------------
function initReaction(){
  const player=window.__playerName||'Player';
  const rounds=Number(document.getElementById('reactionRounds').value);
  const area=document.getElementById('reactionArea');
  let totalTime=0,currentRound=0;
  function startRound(){
    currentRound++;
    if(currentRound>rounds){
      saveToOnlineLB('reaction', `${rounds}R`, {name:player,time:totalTime});
      showLBIn('lb-reaction','reaction',`${rounds}R`);
      alert(`Finished! Total time: ${totalTime.toFixed(3)}s`);
      return;
    }
    area.style.background='#333'; area.textContent='Wait...';
    const delay=1000+Math.random()*3000;
    setTimeout(()=>{
      const start=now();
      area.style.background='#0f9'; area.textContent='CLICK!';
      const onClick=()=>{
        const t=now()-start; totalTime+=msToSec(t);
        area.removeEventListener('click',onClick);
        startRound();
      };
      area.addEventListener('click',onClick);
      new Audio('https://www.myinstants.com/media/sounds/button-22.mp3').play().catch(()=>{});
    },delay);
  }
  startRound();
}

// ----------------- Guess the Number -----------------
function initGuess(){
  const target=Math.floor(Math.random()*100)+1;
  let attempts=0;
  const player=window.__playerName;
  const input=document.getElementById('guessInput');
  const btn=document.getElementById('guessBtn');
  const msg=document.getElementById('guessMsg');
  btn.onclick=()=>{
    const val=Number(input.value); attempts++;
    if(val===target){
      msg.textContent=`Correct in ${attempts} tries!`;
      saveToOnlineLB('guess','default',{name:player,time:attempts});
      showLBIn('lb-guess','guess','default');
    } else msg.textContent=val>target?'Too high':'Too low';
  };
}

// ----------------- Math Quiz -----------------
function initMath(){
  const player=window.__playerName; let score=0, total=5;
  const question=document.getElementById('mathQuestion');
  const input=document.getElementById('mathAnswer');
  const btn=document.getElementById('mathBtn'); const msg=document.getElementById('mathMsg');
  function newQ(){
    const a=Math.floor(Math.random()*20)+1, b=Math.floor(Math.random()*20)+1;
    const op=['+','-','*'][Math.floor(Math.random()*3)];
    question.textContent=`${a} ${op} ${b} = ?`;
    return eval(`${a}${op}${b}`);
  }
  let answer=newQ(), count=0;
  btn.onclick=()=>{
    if(Number(input.value)===answer){ score++; msg.textContent='Correct!'; } 
    else msg.textContent=`Wrong, answer was ${answer}`;
    count++; if(count>=total){
      saveToOnlineLB('math','default',{name:player,time:total-score});
      showLBIn('lb-math','math','default');
      msg.textContent+=` | Final Score: ${score}/${total}`;
    } else { answer=newQ(); input.value=''; }
  };
}

// ----------------- Typing Game -----------------
function initTyping(){
  const player=window.__playerName; let rounds=5,current=0,totalTime=0;
  const textEl=document.getElementById('typingText');
  const input=document.getElementById('typingInput');
  const btn=document.getElementById('typingBtn'); const msg=document.getElementById('typingMsg');
  const texts=['asdfgh','qwerty','zxcvbn','jkl','poiuy','lkjhgf'];
  function newRound(){ textEl.textContent=texts[Math.floor(Math.random()*texts.length)]; input.value=''; input.focus(); }
  btn.onclick=()=>{
    const t0=now();
    if(input.value===textEl.textContent){
      totalTime+=msToSec(now()-t0);
      current++;
      msg.textContent='Correct!';
      if(current>=rounds){ saveToOnlineLB('typing','default',{name:player,time:totalTime});
      showLBIn('lb-typing','typing','default'); alert(`Finished! Total time: ${totalTime.toFixed(3)}s`); return; }
      newRound();
    } else msg.textContent='Incorrect!';
  };
  newRound();
}

// ----------------- Number Memory -----------------
function initNumMemory(){
  const player=window.__playerName; let rounds=5,current=0;
  let number=''; const display=document.getElementById('numMemoryDisplay');
  const input=document.getElementById('numMemoryInput'); const btn=document.getElementById('numMemoryBtn'); const msg=document.getElementById('numMemoryMsg');
  function newRound(){ number=Math.floor(Math.random()*9000+1000).toString(); display.textContent=number; input.value=''; setTimeout(()=>display.textContent='?',800); }
  btn.onclick=()=>{
    if(input.value===number){ current++; msg.textContent='Correct!'; }
    else msg.textContent=`Wrong! Was ${number}`;
    if(current>=rounds){ saveToOnlineLB('numMemory','default',{name:player,time:rounds-current}); showLBIn('lb-numMemory','numMemory','default'); alert('Finished!'); return; }
    newRound();
  };
  newRound();
}

// ----------------- Sequence Tap -----------------
function initSeqTap(){
  const player=window.__playerName; let seq=[],current=0;
  const display=document.getElementById('seqTapDisplay'); const buttons=document.getElementById('seqTapButtons'); 
  buttons.innerHTML='';
  const colors=['red','green','blue','yellow'];
  colors.forEach(c=>{ const b=document.createElement('div'); b.className='color-btn'; b.style.background=c; buttons.appendChild(b); b.onclick=()=>check(c); });
  function next(){ seq.push(colors[Math.floor(Math.random()*4)]); current=0; display.textContent='Sequence length: '+seq.length; }
  function check(c){ if(c===seq[current]){ current++; if(current>=seq.length){ next(); } } else { saveToOnlineLB('seqTap','default',{name:player,time:seq.length}); showLBIn('lb-seqTap','seqTap','default'); alert('Wrong! Finished!'); seq=[]; next(); } }
  next();
}

// ----------------- Word Memory Chain -----------------
function initWordChain(){
  const player=window.__playerName; let chain=[],current=0;
  const display=document.getElementById('wordChainDisplay'); const input=document.getElementById('wordChainInput'); const btn=document.getElementById('wordChainBtn'); const msg=document.getElementById('wordChainMsg');
  btn.onclick=()=>{
    const word=input.value.trim().toLowerCase(); input.value='';
    if(!word){ msg.textContent='Enter a word'; return; }
    if(chain.length>0 && word!==chain[chain.length-1]){ saveToOnlineLB('wordChain','default',{name:player,time:chain.length}); showLBIn('lb-wordChain','wordChain','default'); alert('Wrong! Finished!'); chain=[]; display.textContent=''; return; }
    chain.push(word); display.textContent=chain.join(' → '); msg.textContent='Correct!';
  };
}

</script>
</main>
</body>
</html>

